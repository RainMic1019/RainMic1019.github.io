(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{517:function(t,s,a){t.exports=a.p+"assets/img/start_nginx.af629f97.png"},518:function(t,s,a){t.exports=a.p+"assets/img/apply_ssl.83b4d335.png"},519:function(t,s,a){t.exports=a.p+"assets/img/submit_ssl.53790616.png"},520:function(t,s,a){t.exports=a.p+"assets/img/download_ssl.6d3be587.png"},521:function(t,s,a){t.exports=a.p+"assets/img/liuyuxin_site_nginx.6de46a4d.png"},653:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"_1-前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-前言"}},[t._v("#")]),t._v(" 1 前言")]),t._v(" "),s("p",[t._v("之前文章 "),s("RouterLink",{attrs:{to:"/blog/other/notes_of_personal_website.html"}},[t._v("建站过程中的踩坑记录：自定义域名、百度收录与备案")]),t._v(" 中提到，我将会把个人网站从 GitHub Pages 迁移到腾讯云服务器，本文就针对这个过程做个笔记。")],1),t._v(" "),s("blockquote",[s("p",[t._v("备注：我的个人网站是使用 "),s("a",{attrs:{href:"https://www.vuepress.cn/",target:"_blank",rel:"noopener noreferrer"}},[t._v("VuePress"),s("OutboundLink")],1),t._v(" 生成的静态网页。")])]),t._v(" "),s("h2",{attrs:{id:"_2-安装-nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装-nginx"}},[t._v("#")]),t._v(" 2 安装 Nginx")]),t._v(" "),s("p",[t._v("在安装 Nginx 之前，先看看 yum 的源，执行以下命令：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /etc/yum.repos.d/CentOS-Base.repo\n")])])]),s("p",[t._v("输出结果如下：")]),t._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("extras")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("gpgcheck")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("gpgkey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("http://mirrors.tencentyun.com/centos/RPM-GPG-KEY-CentOS-7")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("baseurl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("http://mirrors.tencentyun.com/centos/$releasever/extras/$basearch/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("Qcloud centos extras - $basearch")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("os")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("gpgcheck")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("gpgkey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("http://mirrors.tencentyun.com/centos/RPM-GPG-KEY-CentOS-7")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("baseurl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("http://mirrors.tencentyun.com/centos/$releasever/os/$basearch/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("Qcloud centos os - $basearch")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[t._v("updates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("gpgcheck")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("gpgkey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("http://mirrors.tencentyun.com/centos/RPM-GPG-KEY-CentOS-7")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("baseurl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("http://mirrors.tencentyun.com/centos/$releasever/updates/$basearch/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("Qcloud centos updates - $basearch")]),t._v("\n")])])]),s("p",[t._v("可以看到由于我买的是腾讯云服务器，所以yum源默认为腾讯源，国内的源比较快，就不用修改了。")]),t._v(" "),s("blockquote",[s("p",[t._v("备注：如果源不是国内的话，就自己改一下吧，注意改之前先备份，避免出问题。")])]),t._v(" "),s("p",[t._v("接下来执行以下命令安装 Nginx：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nginx\n")])])]),s("h2",{attrs:{id:"_3-启动-nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动-nginx"}},[t._v("#")]),t._v(" 3 启动 Nginx")]),t._v(" "),s("p",[t._v("安装好后，我们先启动 Nginx 看看效果，命令如下：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("nginx\n")])])]),s("p",[t._v("可以执行以下命令在应用程序中看看 Nginx 有没有启动成功：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("top")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),s("p",[t._v("接下来我们直接访问一下服务器的公网 ip 看看，比如我这里的是：119.29.8.163，可以看到以下界面，表示 Nginx 服务器启动成功：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(517),alt:"启动 Nginx"}})]),t._v(" "),s("h2",{attrs:{id:"_4-配置-nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置-nginx"}},[t._v("#")]),t._v(" 4 配置 Nginx")]),t._v(" "),s("p",[t._v("启动 Nginx 之后会显示默认网站，如果想要它显示指定的静态网站，需要手动配置。")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("首先，我们先把静态网站上传到服务器，比如此处我将静态的 HTML 文件放在 "),s("code",[t._v("/opt/site")]),t._v(" 目录中。")])]),t._v(" "),s("li",[s("p",[t._v("进入 Nginx 安装目录：")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /etc/nginx\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("编辑 "),s("code",[t._v("nginx.conf")]),t._v(" 文件和 "),s("code",[t._v("nginx.conf.default")]),t._v(" 文件，将 "),s("code",[t._v("http.server.location /")]),t._v(" 的 "),s("code",[t._v("root")]),t._v(" 指向云服务器中的静态网站文件夹，此处为 "),s("code",[t._v("/opt/site")]),t._v("：")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("http "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   /opt/site"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 静态html文件存放目录")]),t._v("\n            index  index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认首页")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("配置好后，重启 Nginx")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" reload\n")])])]),s("p",[t._v("重启完成后，刷新 119.29.8.163 页面应该就能看到部署的网站了。")]),t._v(" "),s("h2",{attrs:{id:"_5-配置-https-服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置-https-服务"}},[t._v("#")]),t._v(" 5 配置 HTTPS 服务")]),t._v(" "),s("h3",{attrs:{id:"_5-1-申请-ssl-证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-申请-ssl-证书"}},[t._v("#")]),t._v(" 5.1 申请 SSL 证书")]),t._v(" "),s("p",[t._v("我用的是腾讯云服务器，所以可以直接在腾讯云中申请的 SSL 证书，打开腾讯云控制台的 "),s("a",{attrs:{href:"https://console.cloud.tencent.com/ssl",target:"_blank",rel:"noopener noreferrer"}},[t._v("SSL 证书页面"),s("OutboundLink")],1),t._v("，申请免费证书：")]),t._v(" "),s("p",[t._v("注意：")]),t._v(" "),s("ul",[s("li",[t._v("免费证书有效期是一年，一年后手动重新申请即可；")]),t._v(" "),s("li",[t._v("申请 SSL 证书的域名需要备案。")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(518),alt:"申请 SSL 证书"}})]),t._v(" "),s("p",[t._v("填写好资料后，提交申请即可：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(519),alt:"提交申请"}})]),t._v(" "),s("h3",{attrs:{id:"_5-2-下载-ssl-证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-下载-ssl-证书"}},[t._v("#")]),t._v(" 5.2 下载 SSL 证书")]),t._v(" "),s("p",[t._v("申请通过后，可以在腾讯云控制台的 "),s("a",{attrs:{href:"https://console.cloud.tencent.com/ssl",target:"_blank",rel:"noopener noreferrer"}},[t._v("SSL 证书页面"),s("OutboundLink")],1),t._v(" 找到对应的证书并下载（注意：下载 Nginx 类型的证书）：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(520),alt:"下载 SSL 证书"}})]),t._v(" "),s("p",[t._v("下载完成后，得到 liuyuxin.site_nginx.zip 压缩包，解压后目录结构如下：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(521),alt:"liuyuxin_site_nginx"}})]),t._v(" "),s("h3",{attrs:{id:"_5-3-使用-ssl-证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-使用-ssl-证书"}},[t._v("#")]),t._v(" 5.3 使用 SSL 证书")]),t._v(" "),s("p",[t._v("首先，我们现在腾讯云控制台的 "),s("a",{attrs:{href:"https://console.cloud.tencent.com/cns",target:"_blank",rel:"noopener noreferrer"}},[t._v("DNS 解析 DNSPod 页面"),s("OutboundLink")],1),t._v("，将域名解析到云服务器 IP，这样通过域名就可以访问个人网站了。")]),t._v(" "),s("p",[t._v("接着开始配置 SSL 证书，需要上传到 Nginx 服务器的文件如下：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("文件")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("liuyuxin.site_bundle.crt")]),t._v(" "),s("td",[t._v("证书文件")])]),t._v(" "),s("tr",[s("td",[t._v("liuyuxin.site.key")]),t._v(" "),s("td",[t._v("私钥文件")])])])]),t._v(" "),s("p",[t._v("将这两个文件放到云服务器的 Nginx 安装目录（"),s("code",[t._v("/etc/nginx")]),t._v("）中的 "),s("code",[t._v("ssl")]),t._v(" 文件夹中，这个路径可自定义，后续可以在配置文件中指定。")]),t._v(" "),s("p",[t._v("编辑 "),s("code",[t._v("/etc/nginx/nginx.conf")]),t._v(" 文件，开启 HTTPS 默认端口 443：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("http "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SSL 默认访问端口号为 443")]),t._v("\n        listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置绑定证书的域名")]),t._v("\n        server_name liuyuxin.site"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置证书文件的相对路径或绝对路径")]),t._v("\n        ssl_certificate "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/nginx/ssl/liuyuxin.site_bundle.crt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置私钥文件的相对路径或绝对路径")]),t._v("\n        ssl_certificate_key "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/nginx/ssl/liuyuxin.site.key"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        ssl_session_timeout 5m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置协议")]),t._v("\n        ssl_protocols TLSv1.2 TLSv1.3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置加密套件，写法遵循 openssl 标准")]),t._v("\n        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("aNULL:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("MD5:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("RC4:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("DHE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        ssl_prefer_server_ciphers on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 网站主页路径")]),t._v("\n            root   /opt/site"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("配置好后，执行以下命令验证配置文件问题，返回 ok 则表示配置文件可正常运行：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v("\n")])])]),s("p",[t._v("重启 Nginx 服务：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" reload\n")])])]),s("p",[t._v("此时，我们可以通过 HTTPS 协议访问网页了：https://liuyuxin.site/")]),t._v(" "),s("h3",{attrs:{id:"_5-4-http-自动跳转-https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-http-自动跳转-https"}},[t._v("#")]),t._v(" 5.4 HTTP 自动跳转 HTTPS")]),t._v(" "),s("p",[t._v("为保证数据安全，我这里将 HTTP 请求自动重定向到了 HTTPS，编辑 "),s("code",[t._v("/etc/nginx/nginx.conf")]),t._v(" 文件，新增重定向配置：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("http "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SSL 默认访问端口号为 443")]),t._v("\n        listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" ssl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置绑定证书的域名")]),t._v("\n        server_name liuyuxin.site"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置证书文件的相对路径或绝对路径")]),t._v("\n        ssl_certificate "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/nginx/ssl/liuyuxin.site_bundle.crt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置私钥文件的相对路径或绝对路径")]),t._v("\n        ssl_certificate_key "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/etc/nginx/ssl/liuyuxin.site.key"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        ssl_session_timeout 5m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置协议")]),t._v("\n        ssl_protocols TLSv1.2 TLSv1.3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置加密套件，写法遵循 openssl 标准")]),t._v("\n        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("aNULL:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("MD5:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("RC4:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("DHE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        ssl_prefer_server_ciphers on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 网站主页路径")]),t._v("\n            root   /opt/site"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            index  index.html index.htm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置绑定证书的域名")]),t._v("\n        server_name liuyuxin.site"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 把 http 的域名请求转成 https")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("配置好后，执行以下命令验证配置文件，并重启 Nginx 服务：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v("\nnginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" reload\n")])])]),s("h2",{attrs:{id:"_6-自动部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-自动部署"}},[t._v("#")]),t._v(" 6 自动部署")]),t._v(" "),s("p",[t._v("由于手动更新云服务器上的静态网站文件比较麻烦，因此这里我写了一个 shell 脚本自动部署网站，其原理很简单，就是通过 ssh 把 Vuepress 编译生成的静态网页上传到云服务器的指定目录，代码如下：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 确保脚本抛出遇到的错误")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成静态网站")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run docs:build\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"==================== build html done ===================="')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 清除服务器上的静态网站")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" root@119.29.8.163 "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rm -rf /opt/site"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"==================== clear html done ===================="')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将静态网站部署到服务器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v(" ./site root@119.29.8.163:/opt\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"==================== deploy html done ===================="')]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("注意：该脚本会先清除服务器上原来的网站，再部署新的网站，因此需要输入两次密码。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);